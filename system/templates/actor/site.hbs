{{#*inline "subcard"}}

{{#if item}} {{! Live item view }}

<div style="padding: 1em; width: 100%; position: relative;" data-item="{{item.id}}">

  <div class="flexrow">
    <h4 style="margin: 0;">{{item.name}}</h4>
  </div>
  <p>{{item.data.data.summary}}</p>

  {{#if actor.data.flags.foundry-ironsworn.edit-mode}}
  <div class="flexrow" style="position: absolute; right: 5px; top: 5px;">
    <div class="clickable block nogrow ironsworn__{{item.type}}__settings" title="{{localize 'IRONSWORN.Edit'}}"
      data-item="{{item.id}}" style="padding: 5px;">
      <i class="fas fa-edit"></i>
    </div>
    <div class="clickable block nogrow ironsworn__{{item.type}}__delete" title="{{localize 'IRONSWORN.DeleteItem'}}"
      data-item="{{item.id}}" style="padding: 5px;">
      <i class="fas fa-trash"></i>
    </div>
  </div>
  {{/if}}
</div>

{{else}} {{! Prompt to drag an item in }}

<div class="flexcol">
  <h4>{{localize titlekey}}</h4>
  <div class="flexrow">
    <div class="inset clickable block ironsworn__compendium__open" style="padding: 5px 2em;"
      data-compendium="{{compendiumkey}}">
      <p>{{localize 'IRONSWORN.OpenCompendium'}}</p>
    </div>
  </div>
</div>

{{/if}}

{{/inline}}

<form class="{{cssClass}} flexcol" autocomplete="off">

  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="50" width="50" />
    <h1 class="charname"><input name="name" type="text" value="{{actor.name}}"
        placeholder="{{localize 'IRONSWORN.Name'}}" /></h1>
  </header>

  <div class="flexcol nogrow" style="margin-bottom: 1em;">
    <div class="flexrow">
      <div class="flexrow">{{>rankHexes rank=data.data.rank id=id}}</div>

      {{#if actor.data.flags.foundry-ironsworn.edit-mode}}
      <div class="clickable block nogrow ironsworn__progress__clear" title="{{localize 'IRONSWORN.ClearProgress'}}"
        data-item="{{id}}" style="padding: 5px;">
        <i class="fas fa-trash"></i>
      </div>
      {{/if}}

      <div class="clickable block nogrow ironsworn__progress__mark" title="{{localize 'IRONSWORN.MarkProgress'}}"
        data-item="{{id}}" style="padding: 5px;">
        <i class="fas fa-play"></i>
      </div>
    </div>
    <div class="flexrow track">
      {{#each (progressCharacters data.data.current)}}
      <div class="flexcol track-box" style="min-height: 50px;">{{{this}}}</div>
      {{/each}}
    </div>
  </div>

  <div class="flexrow nogrow" style="margin-bottom: 1em; align-items: center;">
    <div class="boxgroup">

      <div class="flexrow boxrow">
        {{#each moves}}
        <div class="box flexrow clickable block ironsworn__builtin__move__roll" data-name="{{Name}}">
          <h4 style="margin: 5px" title="{{Source.Name}}, p{{Source.Page}}">
            {{localize (concat 'IRONSWORN.MoveContents.' Name '.title')}}
          </h4>
        </div>
        {{/each}}
      </div>

      <div class="flexrow boxrow">
        <div class="
            box flexrow clickable block
            ironsworn__feature__roll
            {{#unless (and theme domain)}}disabled{{/unless}}
          " style="justify-content: center; padding: 5px;">
          <h4 class="nogrow" style="margin: 0; white-space: nowrap;">
            {{localize 'IRONSWORN.Feature'}}
          </h4>
        </div>
        <div class="
           box flexrow clickable block
          ironsworn__danger__roll
          {{#unless (and theme domain)}}disabled{{/unless}}
        " style="justify-content: center; padding: 5px;">
          <h4 class="nogrow" style="margin: 0; white-space: nowrap;">
            {{localize 'IRONSWORN.MoveContents.Reveal a Danger.title'}}
          </h4>
        </div>

      </div>
    </div>
  </div>

  <div class="boxgroup flexcol nogrow" style="margin-bottom: 1em;">
    <div class="flexrow boxrow nogrow">
      <div class="flexcol box">
        {{>subcard titlekey='IRONSWORN.Theme' item=theme compendiumkey='ironsworndelvethemes'}}
      </div>
      <div class="flexcol box">
        {{>subcard titlekey='IRONSWORN.Domain' item=domain compendiumkey='ironsworndelvedomains'}}
      </div>
    </div>
  </div>

  <div class="boxgroup">
    <div class="flexrow boxrow box">(denizens)</div>
  </div>
</form>
